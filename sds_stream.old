#include <stdio.h>
#include "visa.h"

int main(void) {
    ViSession defaultRM, instr;
    ViStatus status;
    const char* resource_name = "USB0::0xF4EC::0x1012::SDSAHBAX6R0452::INSTR";

    /*
     * viOpenDefaultRM() must be called before any other VISA operations.
     * It initializes the VISA system and returns a session to the Default
     * Resource Manager.
     */
    status = viOpenDefaultRM(&defaultRM);
    if (status < VI_SUCCESS) {
        printf("Error initializing VISA: 0x%lX\n", status);
        return 1;
    }

    /*
     * The viOpen() function opens a session to the specified resource,
     * which in this case is the USB instrument.
     */
    status = viOpen(defaultRM, (ViRsrc)resource_name, VI_NULL, VI_NULL, &instr);
    if (status < VI_SUCCESS) {
        printf("Error opening session to %s: 0x%lX\n", resource_name, status);
        viClose(defaultRM);
        return 1;
    }

    printf("Successfully opened session to %s\n", resource_name);

    /*
     * All open sessions should be closed before the program exits.
     */
    viClose(instr);
    viClose(defaultRM);

    return 0;
}
